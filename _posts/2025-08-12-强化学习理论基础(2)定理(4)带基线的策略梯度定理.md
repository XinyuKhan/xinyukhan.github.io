# 强化学习理论基础-定理-带基线的策略梯度定理


在[《策略梯度定理》](https://xinyukhan.github.io/2025/08/12/强化学习理论基础(2)定理(3)策略梯度定理.html)一文中我们证明推导了策略梯度定理，现在把它抄到下边以供回忆


<div class="math">

$$
\begin{aligned}
  \frac{\partial J(\boldsymbol{\theta})}{\partial \boldsymbol{\theta}} &= \frac{1 - \gamma^n}{1 - \gamma} \mathbb{E}_{S \sim d(\cdot)} \left [\mathbb{E}_{A \sim \pi(\cdot | S; \boldsymbol{\theta})} \left[ \frac{\partial \ln \pi(A | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \cdot Q_{\pi}(S, A) \right]\right]
\end{aligned} \tag {0.1}
$$

</div>

原始版本的策略梯度算法在实际应用中的效果并不好，不过在引入基线之后，可以有效降低学习过程中的方差，从而提高算法的稳定性和收敛速度。


## 1. 定理

我们假定 $b$ 是一个和动作 $a$ 无关的函数，那么带基线的策略梯度定理可以表示为：


<div class="math">

$$
\begin{aligned}
  \frac{\partial J(\boldsymbol{\theta})}{\partial \boldsymbol{\theta}} &= \frac{1 - \gamma^n}{1 - \gamma} \mathbb{E}_{S \sim d(\cdot)} \left [\mathbb{E}_{A \sim \pi(\cdot | S; \boldsymbol{\theta})} \left[ \frac{\partial \ln \pi(A | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \cdot \left ( Q_{\pi}(S, A) - b \right ) \right]\right]
\end{aligned} \tag {1.1}
$$

</div>

## 2. 证明

我们想证明公式（1.1）成立，只需要证明

<div class="math">

$$
\begin{aligned}
  \mathbb{E}_{A \sim \pi(\cdot | S; \boldsymbol{\theta})} \left[ \frac{\partial \ln \pi(A | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \cdot b \right] &= 0
\end{aligned} \tag {1.2}
$$

</div>

由于 $b$ 与 $a$ 无关，因此可以将 $b$ 提取到期望的外部，于是将公式（1.2）展开可以得到

<div class="math">

$$
\begin{aligned}
  \mathbb{E}_{A \sim \pi(\cdot | S; \boldsymbol{\theta})} \left[ \frac{\partial \ln \pi(A | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \cdot b \right] &= b \cdot \mathbb{E}_{A \sim \pi(\cdot | S; \boldsymbol{\theta})} \left[ \frac{\partial \ln \pi(A | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \right] \\
  &= b \cdot \sum_{a \in \mathcal{A}} \pi(a | S; \boldsymbol{\theta}) \cdot \frac{\partial \ln \pi(a | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \\
  &= b \cdot \sum_{a \in \mathcal{A}} \pi(a | S; \boldsymbol{\theta}) \cdot \frac{1}{\pi(a | S; \boldsymbol{\theta})} \cdot \frac{\partial \pi(a | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \\
  &= b \cdot \sum_{a \in \mathcal{A}} \frac{\partial \pi(a | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \\
\end{aligned} \tag {1.3}
$$

</div>

公式（1.3）中对 $\boldsymbol{\theta}$ 的偏导数和 $a$ 无关，因此可以提出到连加之外

<div class="math">

$$
\begin{aligned}
  \mathbb{E}_{A \sim \pi(\cdot | S; \boldsymbol{\theta})} \left[ \frac{\partial \ln \pi(A | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \cdot b \right] &= b \cdot \sum_{a \in \mathcal{A}} \frac{\partial \pi(a | S; \boldsymbol{\theta})}{\partial \boldsymbol{\theta}} \\
  &= b \cdot \frac{\partial}{\partial \boldsymbol{\theta}} \underbrace{\sum_{a \in \mathcal{A}} \pi(a | S; \boldsymbol{\theta})}_{=1} \\
  &= 0
\end{aligned} \tag {1.3}
$$

</div>


对常量1的偏导数恒等于0

证明结束

未经允许，禁止转载。

